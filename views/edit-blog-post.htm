<input type="text" name="blog-post-title">
<textarea style="width:100%; height:100%;" name="blog-post-content"></textarea>
<button type="submit" id="submit-button">Save</button>

<script>
    setUpEditPage();
    
    function setUpEditPage() {
        var titleField = document.querySelector("[name=blog-post-title]");
        var editorField = document.querySelector("[name=blog-post-content]");
        
        loadPostIfExists(titleField, editorField);
    }
    
    function loadPostIfExists(titleField, editorField) {
        var name = getQueryVariable("name");
        if(!name) {
            return;
        }
        getUrl("_api/get-blog-post.php?name="+name, function(error, res) {
            if(error) {
                return console.error("Something went wrong!",error);
            }
            titleField.setAttribute("value", res.title);
            editorField.innerHTML = res.content;
        });
    }
    
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=');
            if (decodeURIComponent(pair[0]) == variable) {
                return decodeURIComponent(pair[1]);
            }
        }
        return false;
    }
    
    function getUrl(url, callback) {
        httpRequest("GET", url, function(readyState, body) {
            if(readyState == 4) {
                try {
                    var res = JSON.parse(body);
                    if(res.error) {
                        return callback(res.error);
                    }
                    callback(null, res);
                }
                catch(e) {
                    callback(e);
                }
            }
        }).send();
    }
    
    function httpRequest(method, url, callback) {
        var req = new XMLHttpRequest();
        req.open(method, url);
        req.onreadystatechange = function() {
            callback(req.readyState, req.responseText);
        };
        return req;
    }
    
    // ----
    
    var saveButton = document.querySelector("#submit-button");
    saveButton.addEventListener("click", function(e) {
        postUrl("_api/save-blog-post.php", {
            title: titleField.value,
            content: getEditorContent()
        }, function(error, res) {
            if(error) {
                return console.error("Failed to save! "+error);
            }
            console.log("Saved! yay!");
        });
        return false;
    });
    
    function postUrl(url, data, callback) {
        httpRequest("POST", url, function(readyState, body) {
            if(readyState == 4) {
                try {
                    var res = JSON.parse(body);
                    if(res.error) {
                        return callback(res.error);
                    }
                    callback(null, res);
                }
                catch(e) {
                    callback(e+" - '"+body+"'");
                }
            }
        }).send(JSON.stringify(data));
    }
    
    function getEditorContent() {
        return document.querySelector("[name=blog-post-content]").value;
    }
</script>